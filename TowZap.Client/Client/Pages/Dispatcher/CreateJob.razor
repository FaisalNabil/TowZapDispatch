@page "/dispatcher/create-job"
@inject IJobRequestService JobService
@inject NavigationManager Navigation
@inject IJSRuntime JS

<h3>Create New Tow Job</h3>

<div class="card p-4 shadow">
    <EditForm Model="@job" OnValidSubmit="@CreateJobAsync">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <!-- Caller Info -->
        <div class="mb-3">
            <label>Caller Name</label>
            <InputText class="form-control" @bind-Value="job.CallerName" />
        </div>
        <div class="mb-3">
            <label>Caller Phone</label>
            <InputText class="form-control" @bind-Value="job.CallerPhone" />
        </div>

        <!-- Vehicle Info -->
        <div class="row">
            <div class="col">
                <label>VIN</label>
                <InputText class="form-control" @bind-Value="job.VIN" />
            </div>
            <div class="col">
                <label>Year</label>
                <InputText class="form-control" @bind-Value="job.Year" />
            </div>
        </div>
        <div class="row mt-2">
            <div class="col">
                <label>Make</label>
                <InputText class="form-control" @bind-Value="job.Make" />
            </div>
            <div class="col">
                <label>Model</label>
                <InputText class="form-control" @bind-Value="job.Model" />
            </div>
        </div>
        <div class="mt-3">
            <label>Plate Number</label>
            <InputText class="form-control" @bind-Value="job.PlateNumber" />
        </div>

        <!-- Tow Reason -->
        <div class="mt-3">
            <label>Tow Reason</label>
            <InputSelect class="form-select" @bind-Value="job.Reason">
                @foreach (var reason in TowReasons)
                {
                    <option value="@reason">@reason</option>
                }
            </InputSelect>
        </div>

        <!-- Locations -->
        <div class="mt-3">
            <label>Location From</label>
            <InputText class="form-control" @bind-Value="job.FromLocation" />
        </div>
        <div class="mt-3">
            <label>Location To</label>
            <InputText class="form-control" @bind-Value="job.ToLocation" />
        </div>

        <!-- Assignment -->
        <div class="row mt-3">
            <div class="col">
                <label>Assign Driver</label>
                <InputText class="form-control" @bind-Value="job.AssignedDriverId" />
            </div>
            <div class="col">
                <label>Assign Tow Truck</label>
                <InputText class="form-control" @bind-Value="job.AssignedTowTruck" />
            </div>
        </div>

        <!-- Submit -->
        <button class="btn btn-primary mt-4" type="submit">Create Job</button>
    </EditForm>
</div>

@code {
    private CreateJobRequestDTO job = new();
    private string[] TowReasons = new[] { "Normal", "Accident", "Abandoned", "PPI", "Other" };

    private async Task CreateJobAsync()
    {
        var result = await JobService.CreateJobAsync(job);
        if (result)
        {
            await JS.InvokeVoidAsync("toast.success", "Job created successfully!");
            Navigation.NavigateTo("/dispatcher/jobs");
        }
        else
        {
            await JS.InvokeVoidAsync("toast.error", "Failed to create job.");
        }
    }
}
